using Newtonsoft.Json;
using Newtonsoft.Json.Linq;

string papeis = @"[
    {
      ""codigoCarteira"": 105,
      ""identificadorPapel"": ""CDB-DI-POS"",
      ""saldoAtual"": 50000.00,
      ""saldoBruto"": 52500.50,
      ""valorMinimoResgate"": 100.00,
      ""valorMinimoPermanente"": 50.00
    },
    {
      ""codigoCarteira"": 110,
      ""identificadorPapel"": ""RDB-PRE"",
      ""saldoAtual"": 15000.00,
      ""saldoBruto"": 16200.75,
      ""valorMinimoResgate"": 500.00,
      ""valorMinimoPermanente"": 100.00
    }
  ]";


string sListaCarteirasJson = papeis?.ToString() ?? "[]";

JArray lisCarteiras = !string.IsNullOrWhiteSpace(sListaCarteirasJson)
    ? JArray.Parse(sListaCarteirasJson)
    : new JArray();

JArray novaLista = new JArray();

HashSet<string> papeisJaAdicionados = new HashSet<string>();

foreach (JToken item in lisCarteiras)
{
    if (item is JObject jo)
    {
        string papel = jo["identificadorPapel"]?.Value<string>() ?? "";

        if (!string.IsNullOrWhiteSpace(papel) && !papeisJaAdicionados.Contains(papel))
        {
            papeisJaAdicionados.Add(papel);

            JObject novoItem = new JObject();
            novoItem["nam"] = papel;
            novoItem["val"] = papel;
            novaLista.Add(novoItem);
        }
    }
}

string papeisFomatadosLista = novaLista.ToString(Formatting.None);

Console.WriteLine(papeisFomatadosLista);
